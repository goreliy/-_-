{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block content %}
<div class="dashboard">
    <!-- –°—Ç–∞—Ç—É—Å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
    <div class="status-cards">
        <div class="card status-card" id="modbus-card">
            <div class="card-header">
                <span class="icon">üîå</span>
                <h3>Modbus Server</h3>
                <span class="status-badge stopped" id="modbus-status">Stopped</span>
            </div>
            <div class="card-body">
                <div class="stat-row">
                    <span class="label">–ü–æ—Ä—Ç</span>
                    <span class="value" id="modbus-port">5020</span>
                </div>
                <div class="stat-row">
                    <span class="label">Unit ID</span>
                    <span class="value" id="modbus-unit">16</span>
                </div>
                <div class="stat-row">
                    <span class="label">–°—Ü–µ–Ω–∞—Ä–∏–π</span>
                    <span class="value" id="modbus-scenario">normal</span>
                </div>
            </div>
            <div class="card-footer">
                <button class="btn btn-sm" onclick="toggleServer('modbus')">Toggle</button>
                <a href="/modbus" class="btn btn-sm">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
            </div>
        </div>
        
        <div class="card status-card" id="current-card">
            <div class="card-header">
                <span class="icon">üìÑ</span>
                <h3>Current Generator</h3>
                <span class="status-badge stopped" id="current-status">Stopped</span>
            </div>
            <div class="card-body">
                <div class="stat-row">
                    <span class="label">–î–∞—Ç—á–∏–∫–æ–≤</span>
                    <span class="value" id="current-sensors">10</span>
                </div>
                <div class="stat-row">
                    <span class="label">–ò–Ω—Ç–µ—Ä–≤–∞–ª</span>
                    <span class="value" id="current-interval">1000 –º—Å</span>
                </div>
                <div class="stat-row">
                    <span class="label">–°—Ü–µ–Ω–∞—Ä–∏–π</span>
                    <span class="value" id="current-scenario">normal</span>
                </div>
            </div>
            <div class="card-footer">
                <button class="btn btn-sm" onclick="toggleServer('current')">Toggle</button>
                <a href="/current" class="btn btn-sm">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
            </div>
        </div>
        
        <div class="card status-card" id="archive-card">
            <div class="card-header">
                <span class="icon">üóÑÔ∏è</span>
                <h3>Archive Server</h3>
                <span class="status-badge stopped" id="archive-status">Stopped</span>
            </div>
            <div class="card-body">
                <div class="stat-row">
                    <span class="label">–ó–∞–ø–∏—Å–µ–π</span>
                    <span class="value" id="archive-records">0</span>
                </div>
                <div class="stat-row">
                    <span class="label">–°–æ–±—ã—Ç–∏–π</span>
                    <span class="value" id="archive-events">0</span>
                </div>
                <div class="stat-row">
                    <span class="label">–ò—Å—Ç–æ—Ä–∏—è</span>
                    <span class="value" id="archive-days">30 –¥–Ω–µ–π</span>
                </div>
            </div>
            <div class="card-footer">
                <button class="btn btn-sm" onclick="toggleServer('archive')">Toggle</button>
                <a href="/archive" class="btn btn-sm">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
            </div>
        </div>
    </div>
    
    <!-- –ë—ã—Å—Ç—Ä—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ -->
    <div class="card">
        <div class="card-header">
            <h3>üé≠ –ë—ã—Å—Ç—Ä—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏</h3>
        </div>
        <div class="card-body">
            <div class="scenario-buttons">
                <button class="btn scenario-btn" onclick="setScenario('normal')">üîµ Normal</button>
                <button class="btn scenario-btn" onclick="setScenario('drift_up')">üìà Drift Up</button>
                <button class="btn scenario-btn" onclick="setScenario('drift_down')">üìâ Drift Down</button>
                <button class="btn scenario-btn" onclick="setScenario('sine')">„Ä∞Ô∏è Sine</button>
                <button class="btn scenario-btn warning" onclick="setScenario('intermittent')">‚ö° Intermittent</button>
                <button class="btn scenario-btn danger" onclick="setScenario('offline')">üî¥ Offline</button>
            </div>
        </div>
    </div>
    
    <!-- –ü—Ä–µ–≤—å—é –¥–∞—Ç—á–∏–∫–æ–≤ -->
    <div class="card">
        <div class="card-header">
            <h3>üì° –¢–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–∞—Ç—á–∏–∫–æ–≤</h3>
            <button class="btn btn-sm" onclick="refreshPreview()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
        </div>
        <div class="card-body">
            <div class="preview-grid" id="sensors-preview">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ –∞—Ä—Ö–∏–≤–∞ -->
<div id="archive-modal" class="modal" style="display:none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modal-title">–ê—Ä—Ö–∏–≤ –¥–∞—Ç—á–∏–∫–∞</h3>
            <button class="btn btn-sm" onclick="closeArchiveModal()">‚úï</button>
        </div>
        <div class="modal-body">
            <div class="chart-controls">
                <select id="chart-period" onchange="updateChart()">
                    <option value="1">1 —á–∞—Å</option>
                    <option value="6">6 —á–∞—Å–æ–≤</option>
                    <option value="24" selected>24 —á–∞—Å–∞</option>
                    <option value="168">–ù–µ–¥–µ–ª—è</option>
                </select>
            </div>
            <canvas id="archive-chart" width="800" height="400"></canvas>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}

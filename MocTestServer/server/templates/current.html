{% extends "base.html" %}

{% block title %}Current Generator{% endblock %}
{% block page_title %}Mock Current Generator{% endblock %}

{% block header_actions %}
<button class="btn" id="btn-toggle" onclick="toggleCurrent()">
    <span id="toggle-text">‚ñ∂ Start</span>
</button>
{% endblock %}

{% block content %}
<div class="settings-page">
    <div class="settings-grid">
        <!-- –í—ã—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã -->
        <div class="card">
            <div class="card-header">
                <h3>üìÅ –í—ã—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã</h3>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label>–ü—É—Ç—å current.json</label>
                    <input type="text" id="cfg-current-path" value="../data/current.json" readonly>
                </div>
                <div class="form-group">
                    <label>–ü—É—Ç—å modbus_log.json</label>
                    <input type="text" id="cfg-log-path" value="../data/modbus_log.json" readonly>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="cfg-gen-log" checked>
                    <label for="cfg-gen-log">–ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥ Modbus</label>
                </div>
            </div>
        </div>
        
        <!-- –î–∞—Ç—á–∏–∫–∏ -->
        <div class="card">
            <div class="card-header">
                <h3>üì° –î–∞—Ç—á–∏–∫–∏</h3>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∞—Ç—á–∏–∫–æ–≤</label>
                    <input type="range" id="cfg-sensors" min="1" max="127" value="10"
                           oninput="document.getElementById('sensors-val').textContent = this.value">
                    <span id="sensors-val">10</span>
                </div>
                <div class="form-group">
                    <label>–ü—Ä–µ—Ñ–∏–∫—Å –∏–º–µ–Ω–∏</label>
                    <input type="text" id="cfg-name-prefix" value="–•–†–ê–ù. ‚Ññ">
                </div>
                <div class="form-group">
                    <label>Slave ID</label>
                    <input type="number" id="cfg-slave-id" value="16" min="1" max="247">
                </div>
            </div>
        </div>
        
        <!-- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è -->
        <div class="card">
            <div class="card-header">
                <h3>‚öôÔ∏è –ì–µ–Ω–µ—Ä–∞—Ü–∏—è</h3>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label>–ò–Ω—Ç–µ—Ä–≤–∞–ª –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–º—Å)</label>
                    <input type="number" id="cfg-interval" value="1000" min="100" max="60000">
                </div>
                <div class="form-group">
                    <label>–°—Ü–µ–Ω–∞—Ä–∏–π</label>
                    <select id="cfg-scenario">
                        <option value="normal">Normal</option>
                        <option value="drift_up">Drift Up</option>
                        <option value="drift_down">Drift Down</option>
                        <option value="sine">Sine</option>
                        <option value="daily_cycle">Daily Cycle</option>
                        <option value="intermittent">Intermittent</option>
                        <option value="offline">Offline</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="card">
            <div class="card-header">
                <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
            </div>
            <div class="card-body">
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-value" id="stat-total">0</span>
                        <span class="stat-label">–í—Å–µ–≥–æ –æ–ø—Ä–æ—Å–æ–≤</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="stat-success">0</span>
                        <span class="stat-label">–£—Å–ø–µ—à–Ω—ã—Ö</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="stat-failed">0</span>
                        <span class="stat-label">–û—à–∏–±–æ–∫</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ö–Ω–æ–ø–∫–∏ -->
    <div class="actions-bar">
        <button class="btn btn-primary" onclick="saveConfig()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button class="btn" onclick="loadConfig()">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
        <button class="btn" onclick="generateOnce()">‚ö° –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑</button>
    </div>
    
    <!-- –ü—Ä–µ–≤—å—é current.json -->
    <div class="card">
        <div class="card-header">
            <h3>üëÅÔ∏è –ü—Ä–µ–≤—å—é current.json</h3>
            <button class="btn btn-sm" onclick="refreshPreview()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
        </div>
        <div class="card-body">
            <pre class="json-preview" id="json-preview">–ó–∞–≥—Ä—É–∑–∫–∞...</pre>
        </div>
    </div>
    
    <!-- –ü—Ä–µ–≤—å—é modbus_log.json -->
    <div class="card">
        <div class="card-header">
            <h3>üìú –ü—Ä–µ–≤—å—é modbus_log.json</h3>
        </div>
        <div class="card-body">
            <div class="log-format-info">
                <p>–§–æ—Ä–º–∞—Ç –∑–∞–ø–∏—Å–µ–π –ª–æ–≥–∞:</p>
                <ul>
                    <li><strong>TX</strong> - –∑–∞–ø—Ä–æ—Å: SlaveID FuncCode StartAddr Quantity CRC</li>
                    <li><strong>RX</strong> - –æ—Ç–≤–µ—Ç: SlaveID FuncCode ByteCount Data CRC</li>
                    <li><strong>response_time_ms</strong> - –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö</li>
                </ul>
            </div>
            <pre class="json-preview" id="log-preview">–ó–∞–≥—Ä—É–∑–∫–∞...</pre>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/current.js') }}"></script>
{% endblock %}

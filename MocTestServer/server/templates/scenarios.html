{% extends "base.html" %}

{% block title %}–°—Ü–µ–Ω–∞—Ä–∏–∏{% endblock %}
{% block page_title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏{% endblock %}

{% block content %}
<div class="scenarios-page">
    <div class="scenarios-grid">
        <!-- –ù–æ—Ä–º–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ -->
        <div class="card">
            <div class="card-header">
                <h3>üîµ –ù–æ—Ä–º–∞–ª—å–Ω—ã–µ</h3>
            </div>
            <div class="card-body">
                <div class="scenario-list">
                    <div class="scenario-item" onclick="selectScenario('normal')">
                        <div class="scenario-icon">üìä</div>
                        <div class="scenario-info">
                            <h4>Normal</h4>
                            <p>–°—Ç–∞–±–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å –Ω–µ–±–æ–ª—å—à–∏–º–∏ –∫–æ–ª–µ–±–∞–Ω–∏—è–º–∏</p>
                        </div>
                    </div>
                    <div class="scenario-item" onclick="selectScenario('sine')">
                        <div class="scenario-icon">„Ä∞Ô∏è</div>
                        <div class="scenario-info">
                            <h4>Sine</h4>
                            <p>–°–∏–Ω—É—Å–æ–∏–¥–∞–ª—å–Ω—ã–µ –∫–æ–ª–µ–±–∞–Ω–∏—è</p>
                        </div>
                    </div>
                    <div class="scenario-item" onclick="selectScenario('daily_cycle')">
                        <div class="scenario-icon">üåÖ</div>
                        <div class="scenario-info">
                            <h4>Daily Cycle</h4>
                            <p>–°—É—Ç–æ—á–Ω—ã–π —Ü–∏–∫–ª —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
        <div class="card">
            <div class="card-header">
                <h3>üìà –ò–∑–º–µ–Ω–µ–Ω–∏—è</h3>
            </div>
            <div class="card-body">
                <div class="scenario-list">
                    <div class="scenario-item" onclick="selectScenario('drift_up')">
                        <div class="scenario-icon">üìà</div>
                        <div class="scenario-info">
                            <h4>Drift Up</h4>
                            <p>–ü–ª–∞–≤–Ω–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã</p>
                        </div>
                    </div>
                    <div class="scenario-item" onclick="selectScenario('drift_down')">
                        <div class="scenario-icon">üìâ</div>
                        <div class="scenario-info">
                            <h4>Drift Down</h4>
                            <p>–ü–ª–∞–≤–Ω–æ–µ –ø–æ–Ω–∏–∂–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã</p>
                        </div>
                    </div>
                    <div class="scenario-item" onclick="selectScenario('hvac_control')">
                        <div class="scenario-icon">‚ùÑÔ∏è</div>
                        <div class="scenario-info">
                            <h4>HVAC Control</h4>
                            <p>–ò–º–∏—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã –∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä–∞</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –°—Ü–µ–Ω–∞—Ä–∏–∏ –æ—à–∏–±–æ–∫ -->
        <div class="card">
            <div class="card-header">
                <h3>‚ö†Ô∏è –û—à–∏–±–∫–∏</h3>
            </div>
            <div class="card-body">
                <div class="scenario-list">
                    <div class="scenario-item warning" onclick="selectScenario('intermittent')">
                        <div class="scenario-icon">‚ö°</div>
                        <div class="scenario-info">
                            <h4>Intermittent</h4>
                            <p>–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ —Å–±–æ–∏ —Å–≤—è–∑–∏</p>
                        </div>
                    </div>
                    <div class="scenario-item warning" onclick="selectScenario('timeout')">
                        <div class="scenario-icon">‚è±Ô∏è</div>
                        <div class="scenario-info">
                            <h4>Timeout</h4>
                            <p>–ß–∞—Å—Ç—ã–µ —Ç–∞–π–º–∞—É—Ç—ã</p>
                        </div>
                    </div>
                    <div class="scenario-item danger" onclick="selectScenario('offline')">
                        <div class="scenario-icon">üî¥</div>
                        <div class="scenario-info">
                            <h4>Offline</h4>
                            <p>–í—Å–µ –¥–∞—Ç—á–∏–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</p>
                        </div>
                    </div>
                    <div class="scenario-item danger" onclick="selectScenario('sensor_failure')">
                        <div class="scenario-icon">üí•</div>
                        <div class="scenario-info">
                            <h4>Sensor Failure</h4>
                            <p>–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π –≤—ã—Ö–æ–¥ –∏–∑ —Å—Ç—Ä–æ—è</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –†–µ–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ -->
        <div class="card">
            <div class="card-header">
                <h3>üåç –†–µ–∞–ª—å–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏</h3>
            </div>
            <div class="card-body">
                <div class="scenario-list">
                    <div class="scenario-item" onclick="selectScenario('door_open')">
                        <div class="scenario-icon">üö™</div>
                        <div class="scenario-info">
                            <h4>Door Open</h4>
                            <p>–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ –¥–≤–µ—Ä–∏</p>
                        </div>
                    </div>
                    <div class="scenario-item warning" onclick="selectScenario('power_outage')">
                        <div class="scenario-icon">üîå</div>
                        <div class="scenario-info">
                            <h4>Power Outage</h4>
                            <p>–û—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–∏—Ç–∞–Ω–∏—è</p>
                        </div>
                    </div>
                    <div class="scenario-item" onclick="selectScenario('partial_offline')">
                        <div class="scenario-icon">üì°</div>
                        <div class="scenario-info">
                            <h4>Partial Offline</h4>
                            <p>–ß–∞—Å—Ç—å –¥–∞—Ç—á–∏–∫–æ–≤ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –¢–µ–∫—É—â–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π -->
    <div class="card current-scenario-card">
        <div class="card-header">
            <h3>üé≠ –¢–µ–∫—É—â–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π</h3>
        </div>
        <div class="card-body">
            <div class="current-scenario-display">
                <span class="scenario-name" id="current-scenario">normal</span>
                <p id="scenario-description">–°—Ç–∞–±–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å –Ω–µ–±–æ–ª—å—à–∏–º–∏ –∫–æ–ª–µ–±–∞–Ω–∏—è–º–∏</p>
            </div>
            <div class="scenario-targets">
                <div class="checkbox-group">
                    <input type="checkbox" id="apply-modbus" checked>
                    <label for="apply-modbus">Modbus Server</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="apply-current" checked>
                    <label for="apply-current">Current Generator</label>
                </div>
            </div>
            <button class="btn btn-primary" onclick="applyScenario()">‚úì –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫–æ –≤—Å–µ–º</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
let selectedScenario = 'normal';

const scenarioDescriptions = {
    'normal': '–°—Ç–∞–±–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å –Ω–µ–±–æ–ª—å—à–∏–º–∏ –∫–æ–ª–µ–±–∞–Ω–∏—è–º–∏',
    'drift_up': '–ü–ª–∞–≤–Ω–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã (–∏–º–∏—Ç–∞—Ü–∏—è –Ω–∞–≥—Ä–µ–≤–∞)',
    'drift_down': '–ü–ª–∞–≤–Ω–æ–µ –ø–æ–Ω–∏–∂–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã (–∏–º–∏—Ç–∞—Ü–∏—è –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è)',
    'sine': '–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ —Å–∏–Ω—É—Å–æ–∏–¥–∞–ª—å–Ω—ã–µ –∫–æ–ª–µ–±–∞–Ω–∏—è',
    'daily_cycle': '–ò–º–∏—Ç–∞—Ü–∏—è —Å—É—Ç–æ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã',
    'hvac_control': '–ò–º–∏—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è',
    'intermittent': '–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ —Å–±–æ–∏ —Å–≤—è–∑–∏ —Å –¥–∞—Ç—á–∏–∫–∞–º–∏',
    'timeout': '–ú–µ–¥–ª–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —Å —á–∞—Å—Ç—ã–º–∏ —Ç–∞–π–º–∞—É—Ç–∞–º–∏',
    'offline': '–í—Å–µ –¥–∞—Ç—á–∏–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã',
    'sensor_failure': '–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π –≤—ã—Ö–æ–¥ –¥–∞—Ç—á–∏–∫–æ–≤ –∏–∑ —Å—Ç—Ä–æ—è',
    'door_open': '–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ –¥–≤–µ—Ä–∏ (—Ä–µ–∑–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)',
    'power_outage': '–û—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–∏—Ç–∞–Ω–∏—è —Å –ø–æ—Å–ª–µ–¥—É—é—â–∏–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º',
    'partial_offline': '–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–∞—Ç—á–∏–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã'
};

function selectScenario(name) {
    selectedScenario = name;
    
    document.querySelectorAll('.scenario-item').forEach(item => {
        item.classList.remove('selected');
    });
    event.currentTarget.classList.add('selected');
    
    document.getElementById('current-scenario').textContent = name;
    document.getElementById('scenario-description').textContent = scenarioDescriptions[name] || name;
}

async function applyScenario() {
    try {
        await api('/api/set_scenario_all', 'POST', { scenario: selectedScenario });
        showToast(`–°—Ü–µ–Ω–∞—Ä–∏–π "${selectedScenario}" –ø—Ä–∏–º–µ–Ω—ë–Ω`, 'success');
    } catch (e) {
        showToast('–û—à–∏–±–∫–∞: ' + e.message, 'error');
    }
}

// Load current scenario
async function loadCurrentScenario() {
    try {
        const status = await api('/api/status');
        const scenario = status.modbus?.scenario || status.current?.scenario || 'normal';
        selectedScenario = scenario;
        document.getElementById('current-scenario').textContent = scenario;
        document.getElementById('scenario-description').textContent = scenarioDescriptions[scenario] || scenario;
    } catch (e) {
        console.error('Error loading scenario:', e);
    }
}

document.addEventListener('DOMContentLoaded', loadCurrentScenario);
</script>
{% endblock %}
